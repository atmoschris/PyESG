

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyesg &mdash; PyESG 0.0.13 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../about.html"/>
    <link rel="top" title="PyESG 0.0.13 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> PyESG</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spherical_geometry.html">Spherical Geometry</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../spherical_geometry.html#point">Point</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spherical_geometry.html#arc">Arc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spherical_geometry.html#triangle">Triangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spherical_geometry.html#quadrangle">Quadrangle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spherical_geometry.html#mesh">Mesh</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../regridding.html">Regridding</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../regridding.html#search">Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regridding.html#interpolation">Interpolation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../code.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#author">Author</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PyESG</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>pyesg</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pyesg</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python3</span>

<span class="c">#========================================================================================</span>
<span class="c"># Author: Feng Zhu</span>
<span class="c"># Date: 2014-12-30 18:19:41</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;0.0.13&#39;</span>
<span class="c">#========================================================================================</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">progressbar</span>
<span class="kn">import</span> <span class="nn">colors</span>

<span class="c">#========================================================================================</span>
<span class="c"># Constants</span>
<span class="c">#----------------------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">Earth</span><span class="p">:</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mi">6371</span> <span class="c"># km</span>
    <span class="n">diameter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radius</span> <span class="c"># km</span>

<span class="k">class</span> <span class="nc">System</span><span class="p">:</span>
    <span class="n">undef</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99999.</span>

<span class="c">#========================================================================================</span>

<span class="c">#========================================================================================</span>
<span class="c"># Spherical geometry</span>
<span class="c">#----------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../code.html#pyesg.Point">[docs]</a><span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A point on the earth defined by the latitude and longitude (unit: degree).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The range of latitude should be [-90, 90]!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The range of longitude should be [-180, 180]!&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lat_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
        <span class="n">lon_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lat_deg</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lon_deg</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>

<div class="viewcode-block" id="Point.lat_deg"><a class="viewcode-back" href="../code.html#pyesg.Point.lat_deg">[docs]</a>    <span class="k">def</span> <span class="nf">lat_deg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; radians -&gt; degree</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lat_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lat_deg</span>
</div>
<div class="viewcode-block" id="Point.lon_deg"><a class="viewcode-back" href="../code.html#pyesg.Point.lon_deg">[docs]</a>    <span class="k">def</span> <span class="nf">lon_deg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; radians -&gt; degree</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">lon_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lon_deg</span>
</div>
<div class="viewcode-block" id="Point.spherical_coord"><a class="viewcode-back" href="../code.html#pyesg.Point.spherical_coord">[docs]</a>    <span class="k">def</span> <span class="nf">spherical_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; p (lat, lon) -&gt; x, y, z</span>

<span class="sd">        Return the (x, y, z) in a UNIT spherical coordinate system.</span>

<span class="sd">        [reference: http://en.wikipedia.org/wiki/Spherical_coordinate_system]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
</div>
<div class="viewcode-block" id="Point.vector"><a class="viewcode-back" href="../code.html#pyesg.Point.vector">[docs]</a>    <span class="k">def</span> <span class="nf">vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return the vector from the center of the Earth to the point.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spherical_coord</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">vector</span>
</div></div>
<div class="viewcode-block" id="Arc"><a class="viewcode-back" href="../code.html#pyesg.Arc">[docs]</a><span class="k">class</span> <span class="nc">Arc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An arc on the earth defined by two points p1 and p2.</span>
<span class="sd">    It also can be seen as the relationship between two points.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delta_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delta_lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span>

        <span class="k">return</span> <span class="n">delta_lat</span>

    <span class="k">def</span> <span class="nf">delta_lon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delta_lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span>

        <span class="k">return</span> <span class="n">delta_lon</span>

    <span class="k">def</span> <span class="nf">delta_sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delta_sigma</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span>
            <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_lat</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_lon</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">delta_sigma</span>

<div class="viewcode-block" id="Arc.distance"><a class="viewcode-back" href="../code.html#pyesg.Arc.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the great-circle distance of the arc.</span>

<span class="sd">        [reference: http://en.wikipedia.org/wiki/Great-circle_distance]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">Earth</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_sigma</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">distance</span>
</div>
<div class="viewcode-block" id="Arc.rad"><a class="viewcode-back" href="../code.html#pyesg.Arc.rad">[docs]</a>    <span class="k">def</span> <span class="nf">rad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Convert great-circle distance on the earth to radians.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">rad</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span> <span class="o">/</span> <span class="n">Earth</span><span class="o">.</span><span class="n">diameter</span>

        <span class="k">return</span> <span class="n">rad</span>
</div>
<div class="viewcode-block" id="Arc.waypoint"><a class="viewcode-back" href="../code.html#pyesg.Arc.waypoint">[docs]</a>    <span class="k">def</span> <span class="nf">waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Calculate the location of a selected point (lat, lon) according to:</span>
<span class="sd">        + the location of point 1 (lat1, lon1);</span>
<span class="sd">        + the location of point 2 (lat2, lon2);</span>
<span class="sd">        + the coefficient k decides the position between point 1 and point 2,</span>

<span class="sd">        e.g.:</span>
<span class="sd">        + when k = 0.0, (lat, lon) is point 1;</span>
<span class="sd">        + when k = 0.5, (lat, lon) is the mid-point;</span>
<span class="sd">        + when k = 1.0, (lat, lon) is point 2.</span>
<span class="sd">        [reference: http://en.wikipedia.org/wiki/Great-circle_navigation]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">alpha1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_lon</span><span class="p">()),</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_lon</span><span class="p">())</span>
                <span class="p">)</span>

        <span class="n">alpha0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">sigma01</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha1</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">sigma02</span> <span class="o">=</span> <span class="n">sigma01</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_sigma</span><span class="p">()</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma02</span><span class="o">-</span><span class="n">sigma01</span><span class="p">)</span> <span class="o">+</span> <span class="n">sigma01</span>

        <span class="n">lat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">lon01</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma01</span><span class="p">),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma01</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">lon0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="n">lon01</span>

        <span class="n">lon_tmp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span>
                <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">lon_tmp</span> <span class="o">+</span> <span class="n">lon0</span>

        <span class="n">wp</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">wp</span>
</div></div>
<div class="viewcode-block" id="Triangle"><a class="viewcode-back" href="../code.html#pyesg.Triangle">[docs]</a><span class="k">class</span> <span class="nc">Triangle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An triangle on the earth defined by three points p1, p2, and p3.</span>
<span class="sd">    It also can be seen as the relationship between three points.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p3</span> <span class="o">=</span> <span class="n">p3</span>

        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc3</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_same_great_circle</span><span class="p">(</span><span class="n">arc1</span><span class="p">,</span> <span class="n">arc2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_same_great_circle</span><span class="p">(</span><span class="n">arc1</span><span class="p">,</span> <span class="n">arc3</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_same_great_circle</span><span class="p">(</span><span class="n">arc2</span><span class="p">,</span> <span class="n">arc3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The three given points are on the same arc!&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>

<div class="viewcode-block" id="Triangle.angles"><a class="viewcode-back" href="../code.html#pyesg.Triangle.angles">[docs]</a>    <span class="k">def</span> <span class="nf">angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the included angle between two sides on the earth.</span>
<span class="sd">        If we set a is the side p2-p3, b the side p3-p1, and c the side p1-p2.</span>
<span class="sd">        Then the return value A is the included angle betwen sides b and c.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc3</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">rad</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">rad</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">arc3</span><span class="o">.</span><span class="n">rad</span><span class="p">()</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span>
                <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span>
</div>
<div class="viewcode-block" id="Triangle.area"><a class="viewcode-back" href="../code.html#pyesg.Triangle.area">[docs]</a>    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Calculate the area of the triangle bounded by the sides made by the</span>
<span class="sd">        three points p1 (lat1, lon1), p2 (lat2, lon2), and p3 (lat3, lon3) according to</span>
<span class="sd">        the Girard&#39;s Theorem:</span>
<span class="sd">        $area = R^2 * E$,</span>
<span class="sd">        where R is the radius of the sphere, and E the angle excess:</span>
<span class="sd">        $E = A + B + C - \pi$.</span>
<span class="sd">        Cosine rules are used to calculate the angles A, B, and C.</span>

<span class="sd">        [references:</span>
<span class="sd">        http://www.princeton.edu/~rvdb/WebGL/GirardThmProof.html</span>
<span class="sd">        http://en.wikipedia.org/wiki/Spherical_trigonometry</span>
<span class="sd">        http://mathforum.org/library/drmath/view/65316.html</span>
<span class="sd">        ]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">()</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">area</span> <span class="o">=</span> <span class="n">Earth</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">E</span>

        <span class="k">return</span> <span class="n">area</span>
</div></div>
<div class="viewcode-block" id="Quadrangle"><a class="viewcode-back" href="../code.html#pyesg.Quadrangle">[docs]</a><span class="k">class</span> <span class="nc">Quadrangle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An quadrangle on the earth defined by three points p1, p2, p3, and p4.</span>
<span class="sd">    It also can be seen as the relationship between four points.</span>

<span class="sd">    Note: p1 -&gt; p2 -&gt; p3 -&gt; p4 should be rotative.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_rotative</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given four points are in wrong sequence!&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p2</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p3</span> <span class="o">=</span> <span class="n">p3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p4</span> <span class="o">=</span> <span class="n">p4</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &lt;-&gt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>

<div class="viewcode-block" id="Quadrangle.angles"><a class="viewcode-back" href="../code.html#pyesg.Quadrangle.angles">[docs]</a>    <span class="k">def</span> <span class="nf">angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Treated as two triangles.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>
        <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>

        <span class="n">A</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">D1</span> <span class="o">=</span> <span class="n">tri1</span><span class="o">.</span><span class="n">angles</span><span class="p">()</span>
        <span class="n">C</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">B2</span> <span class="o">=</span> <span class="n">tri2</span><span class="o">.</span><span class="n">angles</span><span class="p">()</span>

        <span class="n">B</span> <span class="o">=</span> <span class="n">B1</span> <span class="o">+</span> <span class="n">B2</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">D1</span> <span class="o">+</span> <span class="n">D2</span>

        <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span>
</div>
<div class="viewcode-block" id="Quadrangle.area"><a class="viewcode-back" href="../code.html#pyesg.Quadrangle.area">[docs]</a>    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        [reference: http://mathworld.wolfram.com/SphericalPolygon.html]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">()</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">area</span> <span class="o">=</span> <span class="n">Earth</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">E</span>

        <span class="k">return</span> <span class="n">area</span>
</div></div>
<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../code.html#pyesg.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Unstructed mesh grids, which is defined by 2 dimenional arrays lat2d and lon2d.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat2d</span><span class="p">,</span> <span class="n">lon2d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lat2d</span> <span class="o">=</span> <span class="n">lat2d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lon2d</span> <span class="o">=</span> <span class="n">lon2d</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; x &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon2d</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</div>
<span class="k">class</span> <span class="nc">Check</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">is_close_enough</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if two values are close enough.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v1</span> <span class="o">-</span> <span class="n">v2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_equal</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the given two points are equal.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">p1</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">p2</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lon</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_one_of_grids</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point is one of the mesh grids.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nlat</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlon</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">grids</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon</span><span class="p">):</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                <span class="n">grids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pm</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">pm</span><span class="o">.</span><span class="n">lon</span><span class="p">))</span>

        <span class="c">#if (point.lat_deg(), point.lon_deg()) in grids:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="ow">in</span> <span class="n">grids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_rotative</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if the given four points are rotative (positive or negative).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vec12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="o">-</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">lon</span><span class="o">-</span><span class="n">p1</span><span class="o">.</span><span class="n">lon</span><span class="p">])</span>
        <span class="n">vec23</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p3</span><span class="o">.</span><span class="n">lat</span><span class="o">-</span><span class="n">p2</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p3</span><span class="o">.</span><span class="n">lon</span><span class="o">-</span><span class="n">p2</span><span class="o">.</span><span class="n">lon</span><span class="p">])</span>
        <span class="n">vec34</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p4</span><span class="o">.</span><span class="n">lat</span><span class="o">-</span><span class="n">p3</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p4</span><span class="o">.</span><span class="n">lon</span><span class="o">-</span><span class="n">p3</span><span class="o">.</span><span class="n">lon</span><span class="p">])</span>
        <span class="n">vec41</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p1</span><span class="o">.</span><span class="n">lat</span><span class="o">-</span><span class="n">p4</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">lon</span><span class="o">-</span><span class="n">p4</span><span class="o">.</span><span class="n">lon</span><span class="p">])</span>

        <span class="n">n123</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec12</span><span class="p">,</span> <span class="n">vec23</span><span class="p">)</span>
        <span class="n">n234</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec23</span><span class="p">,</span> <span class="n">vec34</span><span class="p">)</span>
        <span class="n">n341</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec34</span><span class="p">,</span> <span class="n">vec41</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n123</span><span class="p">,</span> <span class="n">n234</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n234</span><span class="p">,</span> <span class="n">n341</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_same_great_circle</span><span class="p">(</span><span class="n">arc1</span><span class="p">,</span> <span class="n">arc2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if two given arcs are on the same great_circle.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vec11</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec12</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec21</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec22</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>

        <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec11</span><span class="p">,</span> <span class="n">vec12</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec21</span><span class="p">,</span> <span class="n">vec22</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
        <span class="n">mag_t</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mag_t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_on_great_circle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point is on the great_circle defined by the given arc.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_same_great_circle</span><span class="p">(</span><span class="n">arc1</span><span class="p">,</span> <span class="n">arc2</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point is on the given arc.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_on_great_circle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="p">):</span>
            <span class="c">#print(&#39;--------&#39;)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">arc</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;inner&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;outer&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">),</span> <span class="n">d</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">)):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_intersected</span><span class="p">(</span><span class="n">arc1</span><span class="p">,</span> <span class="n">arc2</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if two great-circle arcs are intersected.</span>

<span class="sd">        [reference:</span>
<span class="sd">        http://www.mathworks.com/matlabcentral/newsreader/view_thread/276271</span>
<span class="sd">        http://stackoverflow.com/questions/2954337/great-circle-rhumb-line-intersection</span>
<span class="sd">        ]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">vec11</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec12</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec21</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p1</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>
        <span class="n">vec22</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p2</span><span class="o">.</span><span class="n">vector</span><span class="p">()</span>

        <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec11</span><span class="p">,</span> <span class="n">vec12</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vec21</span><span class="p">,</span> <span class="n">vec22</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
        <span class="n">mag_t</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mag_t</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="n">mag_t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given two arcs lie on the same great-circle!&#39;</span><span class="p">)</span>

        <span class="n">p2</span> <span class="o">=</span> <span class="o">-</span><span class="n">p1</span>

        <span class="n">lat1_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">lon1_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">intersected_p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lat1_deg</span><span class="p">,</span> <span class="n">lon1_deg</span><span class="p">)</span>

        <span class="n">lat2_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">lon2_deg</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">intersected_p2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">lat2_deg</span><span class="p">,</span> <span class="n">lon2_deg</span><span class="p">)</span>

        <span class="n">arc_p1_11</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p1</span><span class="p">,</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc_p2_11</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p2</span><span class="p">,</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arc_p1_11</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">arc_p2_11</span><span class="o">.</span><span class="n">distance</span><span class="p">():</span>
            <span class="n">intersected_p</span> <span class="o">=</span> <span class="n">intersected_p1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intersected_p</span> <span class="o">=</span> <span class="n">intersected_p2</span>

        <span class="c">#print(intersected_p)</span>

        <span class="n">arc_p_11</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p</span><span class="p">,</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc_p_12</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p</span><span class="p">,</span> <span class="n">arc1</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">arc_p_21</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p</span><span class="p">,</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc_p_22</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">intersected_p</span><span class="p">,</span> <span class="n">arc2</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="n">d_p_11</span> <span class="o">=</span> <span class="n">arc_p_11</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d_p_12</span> <span class="o">=</span> <span class="n">arc_p_12</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d_p_21</span> <span class="o">=</span> <span class="n">arc_p_21</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d_p_22</span> <span class="o">=</span> <span class="n">arc_p_22</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>

        <span class="n">d1</span> <span class="o">=</span> <span class="n">arc1</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">arc2</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="n">d_p_11</span><span class="o">+</span><span class="n">d_p_12</span><span class="p">,</span> <span class="n">d1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_close_enough</span><span class="p">(</span><span class="n">d_p_21</span><span class="o">+</span><span class="n">d_p_22</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">intersected_p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">is_on_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point (lat, lon) is on one of the sides of the given triangle.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc3</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;inner&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point (lat, lon) is inside (including on) the given triangle.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">arc3</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_on_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;outer&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;outer&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;outer&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">north_pole</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">north_pole</span><span class="p">)</span>

        <span class="n">num_intersected_points</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">check1</span><span class="p">,</span> <span class="n">inter_p1</span> <span class="o">=</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_intersected</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">arc1</span><span class="p">)</span>
        <span class="n">check2</span><span class="p">,</span> <span class="n">inter_p2</span> <span class="o">=</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_intersected</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">arc2</span><span class="p">)</span>
        <span class="n">check3</span><span class="p">,</span> <span class="n">inter_p3</span> <span class="o">=</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_intersected</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">arc3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">check1</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c">#print(&#39;Intersected with arc1:&#39;, arc1, &#39;at&#39;, inter_p1)</span>
            <span class="n">num_intersected_points</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">check2</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c">#print(&#39;Intersected with arc2:&#39;, arc2, &#39;at&#39;, inter_p2)</span>
            <span class="n">num_intersected_points</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">check3</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="c">#print(&#39;Intersected with arc3:&#39;, arc3, &#39;at&#39;, inter_p3)</span>
            <span class="n">num_intersected_points</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">inter_p1</span><span class="p">,</span> <span class="n">inter_p2</span><span class="p">):</span>
            <span class="c">#print(&#39;Same intersected point with arc1 and arc2.&#39;)</span>
            <span class="n">num_intersected_points</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">inter_p1</span><span class="p">,</span> <span class="n">inter_p3</span><span class="p">):</span>
            <span class="c">#print(&#39;Same intersected point with arc1 and arc3.&#39;)</span>
            <span class="n">num_intersected_points</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">inter_p2</span><span class="p">,</span> <span class="n">inter_p3</span><span class="p">):</span>
            <span class="c">#print(&#39;Same intersected point with arc2 and arc3.&#39;)</span>
            <span class="n">num_intersected_points</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="c">#print(num_intersected_points)</span>
        <span class="k">if</span> <span class="n">num_intersected_points</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span> <span class="c"># outside</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span> <span class="c"># inside</span>

    <span class="k">def</span> <span class="nf">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadrangle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a given point (lat, lon) is inside the given quadrangle.</span>
<span class="sd">        Treated as two triangles.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">quadrangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">quadrangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">quadrangle</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>
        <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">quadrangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">quadrangle</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="n">quadrangle</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>
        <span class="c">#tri3 = Triangle(quadrangle.p1, quadrangle.p3, quadrangle.p4)</span>
        <span class="c">#tri4 = Triangle(quadrangle.p1, quadrangle.p2, quadrangle.p3)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">tri1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">tri2</span><span class="p">):</span>
        <span class="c">#if Check.is_inside_triangle(point, tri1) or Check.is_inside_triangle(point, tri2) or Check.is_inside_triangle(point, tri3) or Check.is_inside_triangle(point, tri4):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">Search</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Search the quadrangle which the point located in.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#cdef int i, j</span>

        <span class="n">nlat</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlon</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_one_of_grids</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given point is one of the mesh grids!&#39;</span><span class="p">)</span>

        <span class="n">p11_max</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p12_max</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">nlon</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">nlon</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p21_max</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p22_max</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nlon</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nlon</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">quadr_max</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11_max</span><span class="p">,</span> <span class="n">p12_max</span><span class="p">,</span> <span class="n">p22_max</span><span class="p">,</span> <span class="n">p21_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr_max</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given point is not inside the mesh!&#39;</span><span class="p">)</span>

        <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="c"># left lower corner</span>
        <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="o">=</span> <span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nlon</span><span class="o">-</span><span class="mi">1</span> <span class="c"># right upper corner</span>
        <span class="n">ac</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">-</span> <span class="n">aa</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">-</span> <span class="n">bb</span>

        <span class="k">while</span> <span class="n">ac</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">bd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">last_ac</span> <span class="o">=</span> <span class="n">ac</span>
            <span class="n">last_bd</span> <span class="o">=</span> <span class="n">bd</span>

            <span class="k">if</span> <span class="n">ac</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">bd</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">ee</span><span class="p">,</span> <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span><span class="n">aa</span><span class="o">+</span><span class="n">cc</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">bb</span><span class="o">+</span><span class="n">dd</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

                <span class="n">p111</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p112</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p121</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p122</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>

                <span class="n">quadr1</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p111</span><span class="p">,</span> <span class="n">p112</span><span class="p">,</span> <span class="n">p122</span><span class="p">,</span> <span class="n">p121</span><span class="p">)</span>
                <span class="c">#print(&#39;quadr1:&#39;,quadr1)</span>
                <span class="c">#print(Check.is_inside_quadrangle(point, quadr1))</span>

                <span class="n">p211</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p212</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p221</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p222</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr2</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p211</span><span class="p">,</span> <span class="n">p212</span><span class="p">,</span> <span class="n">p222</span><span class="p">,</span> <span class="n">p221</span><span class="p">)</span>
                <span class="c">#print(&#39;quadr2:&#39;,quadr2)</span>
                <span class="c">#print(Check.is_inside_quadrangle(point, quadr2))</span>

                <span class="n">p311</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p312</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p321</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p322</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr3</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p311</span><span class="p">,</span> <span class="n">p312</span><span class="p">,</span> <span class="n">p322</span><span class="p">,</span> <span class="n">p321</span><span class="p">)</span>
                <span class="c">#print(&#39;quadr3:&#39;,quadr3)</span>
                <span class="c">#print(Check.is_inside_quadrangle(point, quadr3))</span>

                <span class="n">p411</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p412</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p421</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p422</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>

                <span class="n">quadr4</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p411</span><span class="p">,</span> <span class="n">p412</span><span class="p">,</span> <span class="n">p422</span><span class="p">,</span> <span class="n">p421</span><span class="p">)</span>
                <span class="c">#print(&#39;quadr4:&#39;, quadr4)</span>
                <span class="c">#print(Check.is_inside_quadrangle(point, quadr4))</span>

                <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr1</span><span class="p">):</span>
                    <span class="c">#print(&#39;Point is inside quadr1:&#39;, quadr1)</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="n">ee</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="n">ff</span>

                <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2</span><span class="p">):</span>
                    <span class="c">#print(&#39;Point is inside quadr2:&#39;, quadr2)</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="n">ee</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">ff</span>

                <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr3</span><span class="p">):</span>
                    <span class="c">#print(&#39;Point is inside quadr3:&#39;, quadr3)</span>
                    <span class="n">aa</span> <span class="o">=</span> <span class="n">ee</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">ff</span>

                <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr4</span><span class="p">):</span>
                    <span class="c">#print(&#39;Point is inside quadr4:&#39;, quadr4)</span>
                    <span class="n">aa</span> <span class="o">=</span> <span class="n">ee</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="n">ff</span>

            <span class="k">elif</span> <span class="n">ac</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span><span class="n">bb</span><span class="o">+</span><span class="n">dd</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

                <span class="n">p111</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p112</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p121</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p122</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>

                <span class="n">quadr1</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p111</span><span class="p">,</span> <span class="n">p112</span><span class="p">,</span> <span class="n">p122</span><span class="p">,</span> <span class="n">p121</span><span class="p">)</span>

                <span class="n">p211</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p212</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p221</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">ff</span><span class="p">])</span>
                <span class="n">p222</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr2</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p211</span><span class="p">,</span> <span class="n">p212</span><span class="p">,</span> <span class="n">p222</span><span class="p">,</span> <span class="n">p221</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr1</span><span class="p">):</span>
                    <span class="n">dd</span> <span class="o">=</span> <span class="n">ff</span>

                <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2</span><span class="p">):</span>
                    <span class="n">bb</span> <span class="o">=</span> <span class="n">ff</span>

            <span class="k">elif</span> <span class="n">bd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">ee</span> <span class="o">=</span> <span class="p">(</span><span class="n">aa</span><span class="o">+</span><span class="n">cc</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

                <span class="n">p111</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p112</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p121</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p122</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr1</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p111</span><span class="p">,</span> <span class="n">p112</span><span class="p">,</span> <span class="n">p122</span><span class="p">,</span> <span class="n">p121</span><span class="p">)</span>

                <span class="n">p211</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p212</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">ee</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p221</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p222</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr2</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p211</span><span class="p">,</span> <span class="n">p212</span><span class="p">,</span> <span class="n">p222</span><span class="p">,</span> <span class="n">p221</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr1</span><span class="p">):</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="n">ee</span>

                <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2</span><span class="p">):</span>
                    <span class="n">aa</span> <span class="o">=</span> <span class="n">ee</span>

            <span class="n">ac</span> <span class="o">=</span> <span class="n">cc</span> <span class="o">-</span> <span class="n">aa</span>
            <span class="n">bd</span> <span class="o">=</span> <span class="n">dd</span> <span class="o">-</span> <span class="n">bb</span>

            <span class="k">if</span> <span class="n">last_ac</span> <span class="o">==</span> <span class="n">ac</span> <span class="ow">and</span> <span class="n">last_bd</span> <span class="o">==</span> <span class="n">bd</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">red</span><span class="p">(</span><span class="s">&#39;Need to search around... &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; circle.&#39;</span><span class="p">))</span>

                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bb</span><span class="p">,</span> <span class="n">dd</span><span class="p">):</span>
                        <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">quadr2check</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2check</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">quadr2check</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">quadr2check</span><span class="p">,</span> <span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">aa</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>

                        <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">quadr2check</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2check</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">quadr2check</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">quadr2check</span><span class="p">,</span> <span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">cc</span><span class="o">+</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">cc</span><span class="p">):</span>
                        <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

                        <span class="n">quadr2check</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2check</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">quadr2check</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">quadr2check</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">bb</span><span class="o">-</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span>

                        <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                        <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>

                        <span class="n">quadr2check</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr2check</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="n">quadr2check</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">quadr2check</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dd</span><span class="o">+</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dd</span><span class="o">+</span><span class="n">k</span>

        <span class="c">#print(aa, bb, cc, dd)</span>
        <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
        <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
        <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
        <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

        <span class="n">quadr</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>
        <span class="c">#print(quadr)</span>

        <span class="k">return</span> <span class="n">quadr</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span>
        <span class="c">#return aa, bb, cc, dd, quadr</span>

    <span class="k">def</span> <span class="nf">quadrangle_accurate</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Search the quadrangle which the point located in. This method is accurate but slow.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">nlat</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlon</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_one_of_grids</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given point is one of the mesh grids!&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">aa</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">bb</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">dd</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>

                <span class="n">p11</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p12</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">aa</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>
                <span class="n">p21</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">bb</span><span class="p">])</span>
                <span class="n">p22</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">cc</span><span class="p">,</span><span class="n">dd</span><span class="p">])</span>

                <span class="n">quadr</span> <span class="o">=</span> <span class="n">Quadrangle</span><span class="p">(</span><span class="n">p11</span><span class="p">,</span> <span class="n">p12</span><span class="p">,</span> <span class="n">p22</span><span class="p">,</span> <span class="n">p21</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">quadr</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">quadr</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span>

    <span class="k">def</span> <span class="nf">triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Search the triangle which the point located in.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">quadr</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="o">=</span> <span class="n">Search</span><span class="o">.</span><span class="n">quadrangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
        <span class="c">#quadr, aa, bb, cc, dd = Search.quadrangle_accurate(point, mesh)</span>
        <span class="c">#print(aa, bb, cc, dd)</span>

        <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">quadr</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">quadr</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">quadr</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>
        <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">quadr</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">quadr</span><span class="o">.</span><span class="n">p3</span><span class="p">,</span> <span class="n">quadr</span><span class="o">.</span><span class="n">p4</span><span class="p">)</span>
        <span class="c">#print(point)</span>
        <span class="c">#print(tri1)</span>
        <span class="c">#print(tri2)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">tri1</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tri1</span><span class="p">,</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">),</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">dd</span><span class="p">),</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">tri2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tri2</span><span class="p">,</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">dd</span><span class="p">),</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">),</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Something wrong!&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Interp"><a class="viewcode-back" href="../code.html#pyesg.Interp">[docs]</a><span class="k">class</span> <span class="nc">Interp</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Interpolation algorithms.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Interp.barycentric"><a class="viewcode-back" href="../code.html#pyesg.Interp.barycentric">[docs]</a>    <span class="k">def</span> <span class="nf">barycentric</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; (point, triangle) -&gt; weight1, weight2, weight3</span>

<span class="sd">        Barycentric Interpolation: interpolation in a triangle.</span>

<span class="sd">        [reference: https://classes.soe.ucsc.edu/cmps160/Fall10/resources/barycentricInterpolation.pdf]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_inside_triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;The given point is not in the given triangle!&#39;</span><span class="p">)</span>

        <span class="n">arc1</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc2</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">arc3</span> <span class="o">=</span> <span class="n">Arc</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc1</span><span class="p">):</span>

            <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">tri3</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

            <span class="n">A1</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="n">tri2</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">tri3</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc2</span><span class="p">):</span>

            <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">tri3</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

            <span class="n">A1</span> <span class="o">=</span> <span class="n">tri1</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">tri3</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_waypoint</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">arc3</span><span class="p">):</span>

            <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>

            <span class="n">A1</span> <span class="o">=</span> <span class="n">tri1</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="n">tri2</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">tri1</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">tri2</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span>
            <span class="n">tri3</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p1</span><span class="p">,</span> <span class="n">triangle</span><span class="o">.</span><span class="n">p2</span><span class="p">)</span>

            <span class="n">A1</span> <span class="o">=</span> <span class="n">tri1</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="n">tri2</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">tri3</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span>
        <span class="n">A_tri</span> <span class="o">=</span> <span class="n">triangle</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>

        <span class="c">#if not Check.is_close_enough(A, A_tri):</span>
            <span class="c">#print(A_tri - A)</span>
            <span class="c">#print(Check.is_inside_triangle(point, triangle))</span>
            <span class="c">#raise ValueError(&#39;The triangle is too big for barycentric interpolation!&#39;)</span>

        <span class="n">weight1</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">/</span> <span class="n">A</span>
        <span class="n">weight2</span> <span class="o">=</span> <span class="n">A2</span> <span class="o">/</span> <span class="n">A</span>
        <span class="n">weight3</span> <span class="o">=</span> <span class="n">A3</span> <span class="o">/</span> <span class="n">A</span>

        <span class="k">return</span> <span class="n">weight1</span><span class="p">,</span> <span class="n">weight2</span><span class="p">,</span> <span class="n">weight3</span>
</div>
<div class="viewcode-block" id="Interp.regrid"><a class="viewcode-back" href="../code.html#pyesg.Interp.regrid">[docs]</a>    <span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="n">mesh_old</span><span class="p">,</span> <span class="n">mesh_new</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;standard&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; (mesh_old, mesh_new) -&gt; matrix of weights and points indices.</span>

<span class="sd">        Calculate the remapping coefficients (weights) from an old mesh to a new mesh.</span>
<span class="sd">        + When method == standard, the search algorithm can resolve any situation but slow;</span>
<span class="sd">        + When method == quick, the situation is that mesh_old and mesh_new are very similar</span>
<span class="sd">        to each other with some points nudged.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#cdef int i, j</span>

        <span class="n">nlat_old</span> <span class="o">=</span> <span class="n">mesh_old</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlon_old</span> <span class="o">=</span> <span class="n">mesh_old</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


        <span class="n">nlat_new</span> <span class="o">=</span> <span class="n">mesh_new</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nlon_new</span> <span class="o">=</span> <span class="n">mesh_new</span><span class="o">.</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nlat_new</span><span class="p">,</span><span class="n">nlon_new</span><span class="p">))</span>
        <span class="n">weights</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">undef</span>

        <span class="n">lat_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nlat_new</span><span class="p">,</span><span class="n">nlon_new</span><span class="p">))</span>
        <span class="n">lat_index</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">undef</span>

        <span class="n">lon_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">nlat_new</span><span class="p">,</span><span class="n">nlon_new</span><span class="p">))</span>
        <span class="n">lon_index</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">undef</span>

        <span class="k">print</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">(</span><span class="s">&#39;Runing regrid...&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;quick&#39;</span><span class="p">:</span>

            <span class="n">pbar</span> <span class="o">=</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat_new</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon_new</span><span class="p">):</span>
                    <span class="n">p_new</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh_new</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh_new</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">p_old</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh_old</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh_old</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_equal</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">p_old</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tri</span><span class="p">,</span> <span class="p">(</span><span class="n">p1_lat_index</span><span class="p">,</span> <span class="n">p1_lon_index</span><span class="p">),</span> <span class="p">(</span><span class="n">p2_lat_index</span><span class="p">,</span> <span class="n">p2_lon_index</span><span class="p">),</span> <span class="p">(</span><span class="n">p3_lat_index</span><span class="p">,</span> <span class="n">p3_lon_index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Search</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">mesh_old</span><span class="p">)</span>

                        <span class="n">weights</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Interp</span><span class="o">.</span><span class="n">barycentric</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">tri</span><span class="p">)</span>
                        <span class="n">lat_index</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1_lat_index</span><span class="p">,</span> <span class="n">p2_lat_index</span><span class="p">,</span> <span class="n">p3_lat_index</span>
                        <span class="n">lon_index</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1_lon_index</span><span class="p">,</span> <span class="n">p2_lon_index</span><span class="p">,</span> <span class="n">p3_lon_index</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;standard&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlat_new</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">green</span><span class="p">(</span><span class="s">&#39;Processing the (&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nlat_new</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;) row... &#39;</span> <span class="o">+</span> <span class="s">&#39;{:3.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">nlat_new</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;%&#39;</span><span class="p">))</span>
                <span class="n">pbar</span> <span class="o">=</span> <span class="n">progressbar</span><span class="o">.</span><span class="n">ProgressBar</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nlon_new</span><span class="p">)):</span>
                    <span class="n">p_new</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh_new</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh_new</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">p_old</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">mesh_old</span><span class="o">.</span><span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">mesh_old</span><span class="o">.</span><span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">Check</span><span class="o">.</span><span class="n">is_one_of_grids</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">mesh_old</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tri</span><span class="p">,</span> <span class="p">(</span><span class="n">p1_lat_index</span><span class="p">,</span> <span class="n">p1_lon_index</span><span class="p">),</span> <span class="p">(</span><span class="n">p2_lat_index</span><span class="p">,</span> <span class="n">p2_lon_index</span><span class="p">),</span> <span class="p">(</span><span class="n">p3_lat_index</span><span class="p">,</span> <span class="n">p3_lon_index</span><span class="p">)</span> <span class="o">=</span> <span class="n">Search</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">mesh_old</span><span class="p">)</span>

                        <span class="n">weights</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Interp</span><span class="o">.</span><span class="n">barycentric</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">tri</span><span class="p">)</span>
                        <span class="n">lat_index</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1_lat_index</span><span class="p">,</span> <span class="n">p2_lat_index</span><span class="p">,</span> <span class="n">p3_lat_index</span>
                        <span class="n">lon_index</span><span class="p">[:,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1_lon_index</span><span class="p">,</span> <span class="n">p2_lon_index</span><span class="p">,</span> <span class="n">p3_lon_index</span>

        <span class="k">return</span> <span class="n">weights</span><span class="p">,</span> <span class="n">lat_index</span><span class="p">,</span> <span class="n">lon_index</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Feng Zhu.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.13',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>